package com.sascom.chickenstock.account.domain; import jakarta.persistence.*; import lombok.*; import java.time.Instant; @Entity @Table(name="settlement_record", uniqueConstraints=@UniqueConstraint(columnNames={{"orderId","accountId"}})) @Getter @Setter @NoArgsConstructor public class SettlementRecord { @Id @GeneratedValue(strategy=GenerationType.IDENTITY) private Long id; private Long orderId; private Long accountId; @Enumerated(EnumType.STRING) private SettlementStatus status; private Long settledAmount; private Long preReservedConsumed; private Long borrowedConsumed; private Long balanceDelta; private Instant updatedAt=Instant.now(); public static SettlementRecord pending(Long orderId, Long accountId){ SettlementRecord r=new SettlementRecord(); r.orderId=orderId; r.accountId=accountId; r.status=SettlementStatus.PENDING; return r; } public void applied(Long sa, Long pre, Long bor, Long delta){ status=SettlementStatus.APPLIED; settledAmount=sa; preReservedConsumed=pre; borrowedConsumed=bor; balanceDelta=delta; updatedAt=Instant.now(); } public void failed(){ status=SettlementStatus.FAILED; updatedAt=Instant.now(); } }